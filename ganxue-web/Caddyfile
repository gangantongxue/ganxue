ganxue.top {
    root * /home/ganxue/ganxue-web

    # 禁止访问隐藏文件
    @hidden {
        file is_hidden
    }
    handle @hidden {
        respond "Forbidden" 403
    }

    @cors_preflight {
        method OPTIONS
        path /api/*
    }

    # 处理 OPTIONS 预检请求（复杂跨域请求必配）
    handle @cors_preflight {
        header Access-Control-Allow-Origin "https://ganxue.top"
        header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        header Access-Control-Allow-Headers "Authorization, Content-Type, X-Requested-With"
        header Access-Control-Allow-Credentials "true"
        header Access-Control-Max-Age "86400" # 预检缓存1天
        respond "" 204
    }

    # 给 API 请求添加跨域响应头
    handle_path /api/* {
        header Access-Control-Allow-Origin "https://ganxue.top" always
        header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" always
        header Access-Control-Allow-Headers "Authorization, Content-Type, X-Requested-With" always
        header Access-Control-Allow-Credentials "true" always
        reverse_proxy ganxue_server:8080
    }

    # 处理前端路由和静态文件
    handle {
        try_files {path} {path}/ /index.html
        file_server
        header Cache-Control "no-cache"
    }
}